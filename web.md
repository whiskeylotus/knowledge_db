# WEB

## SOP - Same Origin Policy


Same-Origin Policy (SOP) is a browser security mechanism that restricts how scripts or documents from one origin can interact with resources from another origin.

An origin is defined by the combination of scheme (protocol) (`https`, `https`), host (domain) (`google.com`), and port (`80`, `443`).

SOP helps prevent malicious websites from reading or manipulating sensitive data from another site (cookies, localStorage, DOM, etc)

## CORS - Cross-Origin Resource Sharing 

Cross-Origin Resource Sharing (CORS) is a mechanism that relaxes the browser’s same-origin policy. It allows a server to specify, via HTTP headers, which external origins (domain, scheme, port) are permitted to access its resources.

**Key headers**

```
Access-Control-Allow-Origin: <origin | *>
Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS
Access-Control-Allow-Headers: X-Requested-With, Content-Type, Authorization
Access-Control-Allow-Credentials: true (allows cookies/credentials)
Access-Control-Max-Age: <seconds> (caches preflight)
```

CORS also relies on a mechanism by which browsers make a "preflight" request to the server hosting the cross-origin resource, in order to check that the server will permit the actual request.

[CORS Guide](https://developer.mozilla.org/en-US/docs/Web/HTTP/Guides/CORS)

**Common misconfigurations**

- `Access-Control-Allow-Origin: *` combined with `Access-Control-Allow-Credentials: true` (browsers reject — server misuses wildcard).
- Reflecting the `Origin` header back without validating it (effectively allows any origin).
- Overly permissive `Access-Control-Allow-Headers` or `Access-Control-Allow-Methods`

**Testing**

- `curl -H "Origin: http://evil.com" -I https://target/` and check response headers; use browser devtools/network to see preflight.

## Security Headers

- `Content-Security-Policy`: Defines what ressources can be load from where, preventing XSS
- `Strict-Transport-Security`: Enforces HTTPS
- `X-Frame-Options`: Prevents clickjacking
- `Referrer-Policy`: Controls what referrer information is sent
- `X-Content-Type-Options`: Stops MIME sniffing
- `Permissions-Policy` : Controls browser features (Geolocation, camera, etc)

## Web vulnerabilities

### Serialization / Deserialization

Serialiaztion is the process of converting complex data structures to a format that can be sent and received as sequential stream of bytes.

Insecure deserialization is when user-controllable data is deserialized by a website. This potentially enables an attacker to manipulate serialized objects in order to pass harmful data into the application code. 

**Defense**

- Avoid deserialization of user input
- Validate and sanitize all inputs before deserializing
- Create your own class-specific deserilization methods including only your fields


### XSS - Cross-site scripting

**Type**

- Stored XSS: Payload is stored on server (database) and displayed to the victim
- Reflected XSS: Payload is reflected immediatly in response (search parameter)
- DOM-based XSS: Vulnerability in client-side scripts that modify DOM using untrusted input

**Defense**

- Filter input on arrival
- Encode data on output
- Use security headers

What is the difference between XSS and CSRF? 
XSS involves causing a web site to return malicious JavaScript, while CSRF involves inducing a victim user to perform actions they do not intend to do. 

#### CSRF - Cross-site Request Forgery

Vulnerability where a malicious website tricks a user's browser into performing an unwanted action on a site where the user is already unauthenticated. For example, this might be to change the email address on their account, to change their password, or to make a funds transfer.

Three key conditions: 
- relevant action
- cookie-based session handling
- No unpredictable request parameters

**Defense**

- CSRF tokens: unique, secret, and unpredictable value that is generated by the server-side application and shared with the client. If not present, the request will be rejected.
- SameSite cookies



